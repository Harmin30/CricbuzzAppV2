@model CricbuzzAppV2.Models.Match
@{
    Layout = "_UserLayout";
    ViewData["Title"] = "Match Details";
}

<style>
    .match-wrapper {
        max-width: 1100px;
        margin: auto;
    }

    /* MATCH HEADER */
    .match-header {
        background: linear-gradient(135deg, #0F5132, #1b4332);
        color: #fff;
        border-radius: 16px;
        padding: 22px;
        text-align: center;
        box-shadow: 0 10px 28px rgba(0,0,0,.25);
    }

        .match-header .meta {
            font-size: .9rem;
            opacity: .9;
        }

    /* INNINGS HEADER */
    .innings-header {
        background: #f1f3f5;
        border-left: 6px solid #0F5132;
        border-radius: 10px;
        padding: 14px 16px;
        margin-top: 26px;
    }

    .innings-score {
        font-size: 1.15rem;
        font-weight: 700;
        color: #0F5132;
    }

    /* SECTION TITLE */
    .section-title {
        margin-top: 20px;
        margin-bottom: 10px;
        font-weight: 700;
        color: #1b4332;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    /* TABLES */
    .table {
        border-radius: 10px;

        background: #fff;
    }

        .table thead {
            background: #1b4332;
        }

            .table thead th {
                color: #fff;
                font-size: .85rem;
                border: none;
                text-transform: uppercase;
            }

        .table tbody td {
            font-size: .9rem;
            vertical-align: middle;
        }

    .table-hover tbody tr:hover {
        background: #eef5f1;
    }

    /* FIX BOOTSTRAP 5 THEAD OVERRIDE */
    .table thead th {
        background-color: #1b4332 !important;
        color: #ffffff !important;
    }

    .table thead {
        --bs-table-bg: #1b4332;
    }


    /* MOBILE CARDS */
    .mobile-card {
        background: #ffffff;
        border-radius: 12px;
        padding: 12px;
        margin-bottom: 10px;
        box-shadow: 0 4px 14px rgba(0,0,0,.12);
        border-left: 4px solid #0F5132;
    }

    .mobile-name {
        font-weight: 600;
        margin-bottom: 4px;
    }

    .mobile-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 6px;
        margin-top: 6px;
    }

    .mobile-box {
        background: #f8f9fa;
        border-radius: 6px;
        padding: 6px 8px;
        font-size: 0.72rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

        .mobile-box strong {
            font-size: 0.85rem;
            color: #0F5132;
            font-weight: 700;
        }


    /* FORCE TABLE ROW VISIBILITY */
    .table tbody tr {
        background-color: #ffffff;
    }

    .table tbody td {
        border: 1px solid #dee2e6 !important;
        color: #212529;
    }

    .table-bordered > :not(caption) > * {
        border-width: 1px;
    }

    /* FORCE TABLE HEADER VISIBILITY */
    .table thead {
        display: table-header-group;
        background-color: #1b4332 !important;
    }

        .table thead th {
            color: #ffffff !important;
            font-weight: 600;
            font-size: 0.85rem;
            vertical-align: middle;
            border: 1px solid #dee2e6 !important;
        }

    .mobile-stats {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
    }

 


    /* ================= CRICBUZZ MOBILE TABLE (NO SCROLL) ================= */

    .batting-name {
        font-weight: 600;
        line-height: 1.2;
    }

    .batting-dismissal {
        display: block;
        font-size: 0.7rem;
        color: #6c757d;
    }

    /* MOBILE VIEW */
  @@media (max-width: 768px) {
        .table

    {
        font-size: 0.75rem; /* slightly smaller */
    }

    .table th,
    .table td {
        padding: 5px 5px;
        vertical-align: top;
        white-space: normal; /* allow wrapping */
    }

    /* Allow batsman name to wrap */
    .batting-table td:first-child {
        min-width: 120px;
    }

    /* Bowling: hide only maidens */
    .bowling-table th:nth-child(3),
    .bowling-table td:nth-child(3) {
        display: none;
    }

    }

    /* ================= MOBILE HEADER NORMALIZATION ================= */
   @@media (max-width: 768px) {
        /* Uniform table sizing */
        .table

    {
        font-size: 0.75rem;
    }

    .table th,
    .table td {
        padding: 5px 6px;
        vertical-align: middle;
        line-height: 1.2;
    }

    /* ---------- BATSMAN HEADER SHORT LABELS ---------- */
    .batting-table thead th {
        color: transparent !important;
        position: relative;
        height: 34px; /* 🔑 force equal height */
    }

        .batting-table thead th::after {
            content: "";
            position: absolute;
            inset: 0;
            text-align: center;
            line-height: 34px; /* 🔑 center text WITHOUT flex */
            font-size: 0.75rem;
            font-weight: 600;
            color: #ffffff;
            white-space: nowrap;
        }

        .batting-table thead th:nth-child(1)::after {
            content: "Batsman";
        }

        .batting-table thead th:nth-child(2)::after {
            content: "R";
        }

        .batting-table thead th:nth-child(3)::after {
            content: "B";
        }

        .batting-table thead th:nth-child(4)::after {
            content: "4s";
        }

        .batting-table thead th:nth-child(5)::after {
            content: "6s";
        }

        .batting-table thead th:nth-child(6)::after {
            content: "SR";
        }

    /* ---------- BOWLING HEADER SHORT LABELS ---------- */
    .bowling-table thead th {
        color: transparent !important;
        position: relative;
        height: 34px; /* 🔑 SAME height */
    }

        .bowling-table thead th::after {
            content: "";
            position: absolute;
            inset: 0;
            text-align: center;
            line-height: 34px; /* 🔑 SAME line-height */
            font-size: 0.75rem;
            font-weight: 600;
            color: #ffffff;
            white-space: nowrap;
        }

        .bowling-table thead th:nth-child(1)::after {
            content: "Bowler";
        }

        .bowling-table thead th:nth-child(2)::after {
            content: "O";
        }

        .bowling-table thead th:nth-child(3)::after {
            content: "M";
        }

        .bowling-table thead th:nth-child(4)::after {
            content: "R";
        }

        .bowling-table thead th:nth-child(5)::after {
            content: "W";
        }

        .bowling-table thead th:nth-child(6)::after {
            content: "Econ";
        }

    }
</style>


<a asp-action="Matches" class="btn btn-outline-success rounded-pill mb-3">
    ← Back to Matches
</a>

<div class="match-wrapper">

    <!-- MATCH HEADER -->
    <div class="match-header mb-4">
        <h4 class="fw-bold">@Model.DisplayName</h4>
        <div class="meta">
            @Model.MatchType • @Model.Date.ToString("dd MMM yyyy") • @Model.Venue
        </div>

        <span class="badge bg-warning text-dark mt-2">@Model.Status</span>

        @if (!string.IsNullOrWhiteSpace(Model.ResultDescription) && Model.WinnerTeam != null)
        {
            var cleanResult = Model.ResultDescription
            .Replace("won by ", "", StringComparison.OrdinalIgnoreCase)
            .Trim();

            <div class="mt-2 fw-semibold">
                @Model.WinnerTeam.TeamName won by @cleanResult
            </div>
        }


    </div>
@if (Model.MatchInnings != null && Model.MatchInnings.Any())
{
    foreach (var inn in Model.MatchInnings.OrderBy(i => i.InningsNumber))
    {
            <!-- INNINGS HEADER -->
            <div class="innings-header">
                <h6 class="fw-bold mb-1">
                    Innings @inn.InningsNumber — @inn.BattingTeam?.TeamName
                </h6>
                <div class="innings-score">
                    @inn.TotalRuns/@inn.WicketsLost
                    <span class="text-muted fs-6">(@inn.OversBowled overs)</span>
                </div>
            </div>

            <!-- ================= BATSMAN ================= -->
            <div class="section-title">
                <i class="fa-solid fa-cricket-bat-ball"></i> Batting
            </div>

            <div class="table-responsive">
                <table class="table table-bordered align-middle batting-table">
                    <thead>
                        <tr>
                            <th>Batsman</th>
                            <th>Runs</th>
                            <th>Balls</th>
                            <th>Fours</th>
                            <th>Sixes</th>
                            <th>Strike Rate</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var b in inn.BattingScorecards.OrderBy(x => x.BattingPosition))
                        {
                            <tr>
                                <td>
                                    <span class="batting-name">@b.Player?.FullName</span>
                                    <span class="batting-dismissal">
                                        @(string.IsNullOrWhiteSpace(b.HowOut) ? "Not Out" : b.HowOut)
                                    </span>
                                </td>
                                <td>@b.Runs</td>
                                <td>@b.BallsFaced</td>
                                <td>@b.Fours</td>
                                <td>@b.Sixes</td>
                                <td>
                                    @(b.BallsFaced > 0
                                                            ? ((double)b.Runs / b.BallsFaced * 100).ToString("0.0")
                                                            : "0.0")
                    </td>
                </tr>
                                }
                    </tbody>
                </table>
            </div>

            <!-- ================= BOWLING ================= -->
            <div class="section-title mt-4">
                <i class="fa-solid fa-bullseye"></i> Bowling
            </div>

            <div class="table-responsive">
                <table class="table table-bordered align-middle bowling-table">
                    <thead>
                        <tr>
                            <th>Bowler</th>
                            <th>Overs</th>
                            <th>Maidens</th>
                            <th>Runs</th>
                            <th>Wickets</th>
                            <th>Economy</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var bw in inn.BowlingScorecards)
                        {
                            <tr>
                                <td>@bw.Player?.FullName</td>
                                <td>@bw.Overs</td>
                                <td>@bw.Maidens</td>
                                <td>@bw.RunsConceded</td>
                                <td>@bw.Wickets</td>
                                <td>
                                    @(bw.Overs > 0
                                                            ? (bw.RunsConceded / bw.Overs).ToString("0.00")
                                                            : "0.00")
                    </td>
                </tr>
                                }
                    </tbody>
                </table>
            </div>
    }
}
else
{
        <div class="alert alert-secondary text-center mt-4">
            No scorecard data available.
        </div>
}
